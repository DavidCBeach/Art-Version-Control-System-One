<head>
   <meta charset="UTF-8">
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<link rel="stylesheet" type="text/css" href="styles/style.css">
<link href="https://fonts.googleapis.com/css?family=Yanone+Kaffeesatz" rel="stylesheet">
</head>

<body>
  <div id = "whitespace"></div>
  <div id = "shelf">

  <div id = "titles">
    <span class = "title"> A.V.C.S. </span>
    <span class = "subtitle">Art Version Control System</span>


  <br>
<a id = "library" href = "library.html">LIBRARY</a>
  </div>
  <div id= "topspacer">
  </div>

<ul>
  </ul>
</body>
<script>
console.log("running");
const urlParams = new URLSearchParams(window.location.search);
const folder = urlParams.get('file');
$.get('/getinfo?file='+folder).done(function(data){
  info = data["info"];
  for(i = 0; i < info.length; i++){
    var extension = info[i]["extension"];
    if(extension == "psd"){
      extension = "png";
    }
    path = folder+"/"+info[i]["version"]+".";
    $("ul").append("<li><img src='/files/"+path+extension+"' height='300' width='auto'>");
    var date= new Date(parseInt(data["info"][(i).toString()]["date"]));
    $("ul").append("<p>"+date+"</p>");
    var nsdate = date.toString().split(" ").join("");
    $("ul").append("<button onclick=downloadFile('"+path+info[i]["extension"]+"','"+folder+"','.v"+info[i]["version"]+".d"+nsdate+"."+info[i]["extension"]+"')>Download</button></li>");
  }
});
function downloadFile (path,name,dateversion){
  console.log("download intiated",info[0]["extension"]);
  //download(folder, "./public/files/"+path, "image/"+info[i]["extension"]);
  window.open('/download?file='+path+'&name='+name+'&dateversion='+dateversion);

}
</script>
